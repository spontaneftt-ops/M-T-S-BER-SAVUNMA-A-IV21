<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MÄ°T | KIZIL ELMA SÄ°BER SAVUNMA v22.1</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700;900&family=Share+Tech+Mono&family=Rajdhani:wght@300;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

    <style>
        :root {
            /* VarsayÄ±lan Tema (KÄ±rmÄ±zÄ± - DEFCON 1) */
            --hue: 0; 
            --bg-deep: #020202;
            --bg-panel: rgba(10, 11, 14, 0.96);
            --primary: #0a0a0a;
            
            --accent: hsl(var(--hue), 100%, 50%); 
            --accent-dim: hsl(var(--hue), 100%, 20%);
            --accent-glow: hsla(var(--hue), 100%, 50%, 0.35);
            
            --discord: #5865F2;
            --staff-blue: #00ccff;
            --admin-gold: #ffcc00;
            --text-main: #e0e0e0;
            --border: 1px solid rgba(255, 255, 255, 0.08);
            
            --scanline-color: rgba(0,0,0,0.5);
        }

        /* DEFCON THEMES */
        body.defcon-5 { --hue: 120; } /* YEÅžÄ°L - GÃœVENLÄ° */
        body.defcon-4 { --hue: 60; }  /* SARI - DÄ°KKAT */
        body.defcon-3 { --hue: 30; }  /* TURUNCU - TEHDÄ°T */
        body.defcon-1 { --hue: 0; }   /* KIRMIZI - KRÄ°TÄ°K */

        * { margin: 0; padding: 0; box-sizing: border-box; scrollbar-width: thin; scrollbar-color: var(--accent) var(--primary); }
        
        body { 
            background-color: var(--bg-deep);
            color: var(--text-main);
            font-family: 'Rajdhani', sans-serif;
            height: 100vh; overflow: hidden; user-select: none;
            transition: --accent 0.5s ease;
        }

        /* CRT SCANLINE EFFECT */
        .scanlines {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 9999;
            background: linear-gradient(to bottom, rgba(255,255,255,0), rgba(255,255,255,0) 50%, rgba(0,0,0,0.2) 50%, rgba(0,0,0,0.2));
            background-size: 100% 4px;
            animation: scanlineMove 10s linear infinite;
            opacity: 0.3;
        }
        @keyframes scanlineMove { 0% { background-position: 0 0; } 100% { background-position: 0 100%; } }

        /* BOOT SCREEN */
        #boot-screen {
            position: fixed; inset: 0; background: #000; z-index: 5000;
            font-family: 'Share Tech Mono'; color: var(--accent); padding: 50px;
            display: flex; flex-direction: column; justify-content: flex-start;
            font-size: 1.2rem;
        }

        /* BACKGROUND */
        #particles-js { position: absolute; top:0; left:0; width: 100%; height: 100%; z-index: 0; pointer-events: none; }

        /* LAYOUT */
        .app-wrapper { display: flex; flex-direction: column; height: 100%; position: relative; z-index: 10; opacity: 0; transition: opacity 1s; }
        
        header {
            height: 80px; display: flex; justify-content: space-between; align-items: center; padding: 0 30px;
            background: rgba(5, 0, 0, 0.95); border-bottom: 3px solid var(--accent);
            box-shadow: 0 0 30px var(--accent-glow); z-index: 100;
        }

        .workspace { display: flex; flex: 1; overflow: hidden; }
        
        aside {
            width: 300px; background: #050505; border-right: 1px solid #222;
            display: flex; flex-direction: column; padding: 20px 0; transition: 0.3s;
            flex-shrink: 0;
        }

        main { flex: 1; padding: 30px; overflow-y: auto; background: rgba(0,0,0,0.4); position: relative; }

        /* COMPONENTS */
        .glass-box {
            background: var(--bg-panel); border: 1px solid #222; padding: 25px; 
            border-radius: 4px; margin-bottom: 25px; position: relative; 
            box-shadow: 0 10px 40px rgba(0,0,0,0.9); overflow: hidden;
            border-left: 2px solid var(--accent);
            transition: border-color 0.5s;
        }
        
        h2, h3 { font-family: 'Orbitron'; color: var(--accent); margin-bottom: 15px; letter-spacing: 2px; text-transform: uppercase; text-shadow: 0 0 10px var(--accent-glow); transition: color 0.5s; }

        .nav-btn {
            background: transparent; border: none; color: #888; padding: 16px 25px;
            text-align: left; cursor: pointer; font-family: 'Rajdhani'; font-weight: 600; font-size: 1.1rem;
            display: flex; align-items: center; gap: 15px; transition: 0.3s; width: 100%;
            border-right: 3px solid transparent;
        }
        .nav-btn:hover { background: rgba(255, 255, 255, 0.05); color: var(--text-main); }
        .nav-btn.active { background: var(--accent-dim); color: white; border-right-color: var(--accent); }

        /* INPUTS & BUTTONS */
        input, textarea, select {
            width: 100%; background: #0a0a0a; border: 1px solid #333; padding: 12px;
            color: white; font-family: 'Share Tech Mono'; margin-bottom: 15px; outline: none; transition: 0.3s;
        }
        input:focus, select:focus { border-color: var(--accent); box-shadow: 0 0 15px var(--accent-glow); }

        .cyber-btn {
            width: 100%; background: transparent; border: 1px solid var(--accent);
            color: var(--accent); padding: 12px; font-family: 'Orbitron'; cursor: pointer;
            transition: 0.3s; text-transform: uppercase; font-weight: bold; letter-spacing: 1px;
            position: relative; overflow: hidden;
        }
        .cyber-btn:hover { background: var(--accent); color: #000; box-shadow: 0 0 25px var(--accent); }
        .cyber-btn:active { transform: scale(0.98); }
        
        .btn-small { width: auto; padding: 6px 12px; font-size: 0.75rem; margin-right: 5px; }
        .btn-blue { border-color: var(--staff-blue); color: var(--staff-blue); }
        .btn-blue:hover { background: var(--staff-blue); color: #000; box-shadow: 0 0 15px var(--staff-blue); }
        .btn-gold { border-color: var(--admin-gold); color: var(--admin-gold); }
        .btn-gold:hover { background: var(--admin-gold); color: #000; box-shadow: 0 0 15px var(--admin-gold); }

        /* TABLES & DATA */
        .table-container { overflow-x: auto; }
        .cyber-table { width: 100%; border-collapse: collapse; margin-top: 10px; min-width: 500px; }
        .cyber-table th { text-align: left; border-bottom: 1px solid var(--accent); padding: 10px; color: #aaa; font-size: 0.8rem; }
        .cyber-table td { padding: 12px 10px; border-bottom: 1px solid #222; font-family: 'Share Tech Mono'; font-size: 0.9rem; vertical-align: middle; }
        .cyber-table tr:hover { background: rgba(255,255,255,0.03); }

        /* CHAT & REPORTS */
        .chat-window { height: 400px; overflow-y: auto; background: #050505; border: 1px solid #333; padding: 15px; margin-bottom: 15px; display: flex; flex-direction: column; gap: 10px; }
        .msg { padding: 10px; border-radius: 4px; max-width: 80%; font-size: 0.9rem; position: relative; }
        .msg-me { background: var(--accent-dim); align-self: flex-end; border: 1px solid var(--accent); color: white; }
        .msg-other { background: #151515; align-self: flex-start; border: 1px solid #333; color: #ccc; }
        .msg-sender { font-size: 0.7rem; color: var(--staff-blue); display: block; margin-bottom: 3px; font-weight: bold; }

        .report-card { border-left: 3px solid var(--staff-blue); background: #0f0f0f; padding: 15px; margin-bottom: 10px; position: relative; }
        .report-op { border-left-color: var(--accent); }
        .discord-tag { position: absolute; top: 5px; right: 5px; font-size: 0.6rem; color: var(--discord); opacity: 0.8; font-weight: bold; }

        /* BIO CARD */
        .bio-grid { display: grid; grid-template-columns: 100px 1fr; gap: 15px; border: 1px solid var(--accent); padding: 10px; background: rgba(0,0,0,0.5); margin-top: 10px; }
        .bio-img { width: 100%; height: 100px; object-fit: cover; border: 1px solid #444; }
        .bio-data div { display: flex; justify-content: space-between; border-bottom: 1px solid #333; padding: 3px 0; font-family: 'Share Tech Mono'; font-size: 0.9rem; }
        .bio-label { color: var(--accent); font-size: 0.8rem; }

        /* ALERTS */
        #lockdown-screen { background: #000; display: none; position: fixed; inset: 0; z-index: 2000; align-items: center; justify-content: center; flex-direction: column; color: var(--accent); text-align: center; }
        #login-modal, #edit-modal { position: fixed; inset: 0; z-index: 2000; align-items: center; justify-content: center; backdrop-filter: blur(15px); background: rgba(0,0,0,0.85); display: none; }

        .panel { display: none; animation: fadeIn 0.4s ease-out; }
        .panel.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes pulseAlert { 0% { opacity: 1; text-shadow: 0 0 30px var(--accent); } 50% { opacity: 0.4; } 100% { opacity: 1; text-shadow: 0 0 30px var(--accent); } }

        /* MOBIL */
        @media screen and (max-width: 900px) {
            body { overflow: auto; }
            header { height: auto; flex-direction: column; gap: 10px; padding: 15px; text-align: center; }
            header > div { width: 100%; justify-content: center; }
            .workspace { flex-direction: column; overflow: visible; }
            aside { width: 100%; border-right: none; border-bottom: 2px solid var(--accent); padding: 10px 0; }
            #menu-guest, #menu-staff { display: flex !important; flex-direction: row; overflow-x: auto; white-space: nowrap; padding: 0 10px 10px 10px; gap: 10px; }
            #menu-guest[style*="none"], #menu-staff[style*="none"] { display: none !important; }
            .nav-btn { width: auto; padding: 8px 15px; border-right: none; border-bottom: 3px solid transparent; background: rgba(255,255,255,0.05); }
            .nav-btn.active { border-right: none; border-bottom-color: var(--accent); background: var(--accent-dim); }
            main { padding: 15px; }
            div[style*="grid-template-columns"] { grid-template-columns: 1fr !important; gap: 15px !important; }
        }
    </style>
</head>
<body class="defcon-1">

    <div class="scanlines"></div>
    <canvas id="particles-js"></canvas>

    <div id="boot-screen">
        <div id="boot-text"></div>
    </div>

    <div id="lockdown-screen">
        <i class="fas fa-biohazard fa-6x" style="margin-bottom:30px; animation: pulseAlert 1s infinite;"></i>
        <h1 style="font-size:4rem; margin-bottom:10px; font-family: 'Orbitron';">SÄ°STEM KÄ°LÄ°TLENDÄ°</h1>
        <p style="letter-spacing: 5px; font-size:1.5rem;">YETKÄ°SÄ°Z ERÄ°ÅžÄ°M TESPÄ°TÄ°</p>
        <p style="margin-top:20px; color:#666; font-family:'Share Tech Mono'">PROTOKOL: KIZIL-ELMA // IP LOGLANDI</p>
    </div>

    <div class="app-wrapper" id="main-app">
        <header>
            <div style="display:flex; align-items:center; gap:20px;">
                <img src="https://upload.wikimedia.org/wikipedia/tr/6/61/Mitlogo.png" height="60" style="filter: drop-shadow(0 0 15px var(--accent));">
                <div>
                    <h1 style="font-family:'Orbitron'; font-size:1.8rem; line-height:1; color:white;">MÄ°T <span style="color:var(--accent)">KIZIL ELMA</span></h1>
                    <small style="color:#aaa; letter-spacing:2px; font-size:0.75rem;">SÄ°BER SAVUNMA AÄžI v22.1</small>
                </div>
            </div>
            <div style="text-align:right; font-family:'Share Tech Mono'; width:100%; text-align:center; margin-top:5px;">
                <div id="sys-clock" style="font-size:1.4rem; color:white;">00:00:00</div>
                <div id="net-status" style="font-size:0.8rem; color:var(--accent);"><i class="fas fa-shield-alt"></i> BAÄžLANTI GÃœVENLÄ°</div>
            </div>
        </header>

        <div class="workspace">
            <aside>
                <div style="text-align:center; padding: 20px; border-bottom: 1px solid #333; margin-bottom: 10px;">
                    <div style="width:70px; height:70px; border-radius:50%; border:2px solid var(--accent); margin:0 auto 15px; display:flex; align-items:center; justify-content:center; box-shadow: 0 0 20px var(--accent-glow); overflow:hidden; background:#000;">
                        <i class="fas fa-user-secret fa-2x" id="u-icon" style="color:white;"></i>
                        <img id="u-photo" style="display:none; width:100%; height:100%; object-fit:cover;">
                    </div>
                    <h3 id="u-name" style="font-size:1rem; margin-bottom:5px;">MÄ°SAFÄ°R</h3>
                    <p id="u-code" style="font-size:0.9rem; color:var(--staff-blue); font-weight:bold; letter-spacing:1px; display:none;">KOD: YOK</p>
                    <p id="u-role" style="font-size:0.7rem; color:#666;">ERÄ°ÅžÄ°M KISITLI</p>
                </div>

                <div id="menu-guest">
                    <button class="nav-btn active" onclick="app.nav('public')"><i class="fas fa-globe"></i> Duyurular</button>
                    <button class="nav-btn" onclick="app.nav('basvuru')"><i class="fas fa-user-plus"></i> BaÅŸvuru</button>
                    <button class="nav-btn" onclick="app.showLogin()" style="color:var(--accent);"><i class="fas fa-fingerprint"></i> Personel</button>
                </div>

                <div id="menu-staff" style="display:none;">
                    <button class="nav-btn active" onclick="app.nav('dashboard')"><i class="fas fa-th"></i> Komuta</button>
                    <button class="nav-btn" onclick="app.nav('reports')"><i class="fas fa-file-contract"></i> Rapor</button>
                    <button class="nav-btn" onclick="app.nav('ops')"><i class="fas fa-crosshairs"></i> Operasyon</button>
                    <button class="nav-btn" onclick="app.nav('chat')"><i class="fas fa-comments"></i> Chat</button>
                    <button class="nav-btn" onclick="app.nav('hr')"><i class="fas fa-users"></i> Ekip</button>
                    <button class="nav-btn" onclick="app.nav('db')"><i class="fas fa-database"></i> Sorgu</button>
                    <button class="nav-btn" onclick="app.logout()" style="color:var(--accent);"><i class="fas fa-power-off"></i> Ã‡Ä±kÄ±ÅŸ</button>
                </div>
            </aside>

            <main>
                <div id="panel-public" class="panel active">
                    <div class="glass-box">
                        <h2><i class="fas fa-bullhorn"></i> RESMÄ° DUYURULAR</h2>
                        <div id="feed-public"></div>
                    </div>
                    <div class="glass-box"><h3>ARANANLAR</h3><div class="table-container"><table class="cyber-table" id="wanted-table"><thead><tr><th>KOD</th><th>SUÃ‡</th><th>DURUM</th></tr></thead><tbody></tbody></table></div></div>
                    <div class="glass-box" style="max-width:600px;">
                        <h3>Ä°HBAR HATTI (ÅžÄ°FRELÄ°)</h3>
                        <p style="font-size:0.8rem; color:#666; margin-bottom:10px;">KimliÄŸiniz sistem tarafÄ±ndan gizli tutulacaktÄ±r.</p>
                        <input id="tip-subj" placeholder="Ä°hbar Konusu">
                        <textarea id="tip-text" placeholder="Detaylar, Yer, Zaman, EÅŸkal..."></textarea>
                        <button class="cyber-btn" onclick="app.sendTip()">GÃœVENLÄ° GÃ–NDER</button>
                    </div>
                </div>

                <div id="panel-basvuru" class="panel">
                    <div class="glass-box" style="max-width:600px; margin:0 auto;">
                        <h2 style="text-align:center;">AKADEMÄ° BAÅžVURU</h2>
                        <label>TC Kimlik</label><input id="app-tc" maxlength="11">
                        <label>Ad Soyad</label><input id="app-name">
                        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:20px;">
                            <div><label>Cinsiyet</label><select id="app-gender"><option value="men">Erkek</option><option value="women">KadÄ±n</option></select></div>
                            <div><label>BranÅŸ</label><select id="app-skill"><option value="siber">Siber</option><option value="saha">Saha</option><option value="analiz">Analiz</option></select></div>
                        </div>
                        <button class="cyber-btn" onclick="app.submitApp()">GÃ–NDER</button>
                    </div>
                </div>

                <div id="panel-dashboard" class="panel">
                    <div style="display:grid; grid-template-columns: repeat(3, 1fr); gap:20px; margin-bottom:20px;">
                        <div class="glass-box" style="text-align:center;">
                            <small>TEHDÄ°T SEVÄ°YESÄ°</small>
                            <h1 id="defcon-disp" style="color:var(--accent); font-size:3rem; margin-top:5px;">1</h1>
                        </div>
                        <div class="glass-box" style="text-align:center;"><small>PERSONEL</small><h1 id="stat-staff" style="color:white;">0</h1></div>
                        <div class="glass-box" style="text-align:center;"><small>GÃ–REV</small><h1 id="stat-ops" style="color:var(--staff-blue);">0</h1></div>
                    </div>
                    <div class="glass-box"><h3>CANLI AKIÅž</h3><div id="dash-logs" style="height:200px; overflow-y:auto; color:#888; font-size:0.8rem;"></div></div>
                    <div class="glass-box" style="padding:0; height:400px;"><div id="map" style="height:100%;"></div></div>
                </div>

                <div id="panel-reports" class="panel">
                    <div style="display:grid; grid-template-columns: 1fr 2fr; gap:25px;">
                        <div class="glass-box">
                            <h3>RAPOR GÃ–NDER</h3>
                            <p style="font-size:0.7rem; color:var(--discord);">Bu rapor Discord kanalÄ±na iletilecektir.</p>
                            <select id="report-type"><option value="field">SAHA RAPORU</option><option value="intel">Ä°STÄ°HBARAT</option></select>
                            <input id="report-subj" placeholder="BaÅŸlÄ±k">
                            <textarea id="report-content" rows="8" placeholder="Detay..."></textarea>
                            <button class="cyber-btn btn-blue" style="width:100%" onclick="app.submitReport()">HAVUZA & DISCORD'A Ä°LET</button>
                        </div>
                        <div class="glass-box">
                            <h3>HAVUZ</h3>
                            <div id="reports-feed" style="height:500px; overflow-y:auto;"></div>
                        </div>
                    </div>
                </div>

                <div id="panel-chat" class="panel">
                    <div class="glass-box" style="max-width:800px; margin:0 auto;">
                        <h2 style="text-align:center; color:var(--staff-blue);">GÃœVENLÄ° HAT (KOD ADI)</h2>
                        <div class="chat-window" id="chat-window"></div>
                        <div style="display:flex; gap:10px;">
                            <input id="chat-input" placeholder="MesajÄ±nÄ±z..." style="margin:0;">
                            <button class="cyber-btn" onclick="app.sendChat()" style="width:120px; border-color:var(--staff-blue); color:var(--staff-blue);">GÃ–NDER</button>
                        </div>
                    </div>
                </div>

                <div id="panel-ops" class="panel">
                    <div class="glass-box">
                        <div style="display:flex; justify-content:space-between; align-items:center;">
                            <h2>OPERASYON LÄ°STESÄ°</h2>
                            <button class="cyber-btn btn-small" onclick="document.getElementById('new-op-modal').style.display='block'">+ YENÄ° GÃ–REV</button>
                        </div>
                        <div id="new-op-modal" style="display:none; background:#000; padding:20px; border:1px solid var(--accent); margin:20px 0;">
                            <h3>GÃ–REV EMRÄ°</h3>
                            <p style="color:var(--discord); font-size:0.7rem;">Operasyon emri Discord kanalÄ±na dÃ¼ÅŸecektir.</p>
                            <input id="op-name" placeholder="Kod AdÄ±">
                            <label>Lider</label><select id="op-lead"></select>
                            <button class="cyber-btn" onclick="app.addOp()">BAÅžLAT</button>
                            <button class="cyber-btn" style="border-color:#555; color:#555;" onclick="document.getElementById('new-op-modal').style.display='none'">Ä°PTAL</button>
                        </div>
                        <div class="table-container"><table class="cyber-table" id="ops-table"><thead><tr><th>GÃ–REV</th><th>LÄ°DER</th><th>DURUM</th><th>AKSÄ°YON</th></tr></thead><tbody></tbody></table></div>
                    </div>
                </div>

                <div id="panel-hr" class="panel">
                    <div id="admin-tools" class="glass-box" style="display:none; border-color:var(--admin-gold);">
                        <h3 style="color:var(--admin-gold);"><i class="fas fa-cogs"></i> YÃ–NETÄ°CÄ° KONSOLU</h3>
                        <div style="margin-bottom:20px; border-bottom:1px solid #333; padding-bottom:15px;">
                            <label style="color:var(--text-main); font-weight:bold;">TEHDÄ°T SEVÄ°YESÄ° (DEFCON)</label>
                            <div style="display:flex; gap:10px; margin-top:5px;">
                                <button class="cyber-btn btn-small" style="border-color:#00ff00; color:#00ff00;" onclick="app.setDefcon(5)">YEÅžÄ°L (5)</button>
                                <button class="cyber-btn btn-small" style="border-color:#ffff00; color:#ffff00;" onclick="app.setDefcon(4)">SARI (4)</button>
                                <button class="cyber-btn btn-small" style="border-color:#ff8800; color:#ff8800;" onclick="app.setDefcon(3)">TURUNCU (3)</button>
                                <button class="cyber-btn btn-small" style="border-color:#ff0000; color:#ff0000;" onclick="app.setDefcon(1)">KIRMIZI (1)</button>
                            </div>
                        </div>

                        <h3 style="color:var(--admin-gold); margin-top:15px;">DUYURU YAYINLA</h3>
                        <div style="display:flex; gap:15px; flex-wrap:wrap;">
                            <input id="ann-title" placeholder="Duyuru BaÅŸlÄ±ÄŸÄ±" style="flex:1; min-width:200px;">
                            <select id="ann-type" style="width:150px;"><option value="info">Bilgi</option><option value="critical">KRÄ°TÄ°K</option></select>
                        </div>
                        <textarea id="ann-msg" rows="2" placeholder="Mesaj..."></textarea>
                        <button class="cyber-btn btn-gold" onclick="app.adminPostAnnounce()">YAYINLA</button>
                    </div>

                    <div style="display:grid; grid-template-columns: 2fr 1fr; gap:25px;">
                        <div class="glass-box">
                            <h3 id="hr-table-title">EKÄ°P LÄ°STESÄ°</h3>
                            <div style="max-height:500px; overflow-y:auto;" class="table-container">
                                <table class="cyber-table" id="hr-staff-table"><thead id="hr-table-head"></thead><tbody id="hr-table-body"></tbody></table>
                            </div>
                        </div>
                        <div class="glass-box" style="text-align:center;">
                            <h3>KÄ°MLÄ°K KARTI</h3>
                            <canvas id="idCardCanvas" width="500" height="300"></canvas>
                            <br><br>
                            <div id="id-actions"></div>
                        </div>
                    </div>
                    
                    <div id="admin-apps-section" style="display:none;">
                        <div class="glass-box">
                            <h3>BEKLEYEN BAÅžVURULAR</h3>
                            <div id="hr-apps-list" style="display:grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap:15px;"></div>
                        </div>
                        <div class="glass-box">
                            <h3>VATANDAÅž Ä°HBARLARI (WHISTLEBLOWER)</h3>
                            <div id="hr-tips-list" style="max-height:300px; overflow-y:auto;"></div>
                        </div>
                    </div>
                </div>

                <div id="panel-db" class="panel">
                    <div class="glass-box">
                        <h2>GDBS SORGU</h2>
                        <input id="db-q" placeholder="TC Kimlik / Ad Soyad / Plaka">
                        <button class="cyber-btn" onclick="app.queryDB()">SÄ°STEMDE ARA</button>
                        <div id="db-res" style="margin-top:20px;"></div>
                    </div>
                    <div class="glass-box"><h3>DENETÄ°M Ä°ZLERÄ°</h3><div class="table-container"><table class="cyber-table" id="audit-table"><thead><tr><th>ZAMAN</th><th>KULLANICI</th><th>DETAY</th></tr></thead><tbody></tbody></table></div></div>
                </div>

            </main>
        </div>
    </div>

    <div id="login-modal">
        <div class="glass-box" style="width:400px; text-align:center; border:2px solid var(--accent);">
            <i class="fas fa-shield-alt fa-4x" style="color:var(--accent); margin-bottom:20px;"></i>
            <h3>GÃœVENLÄ° GÄ°RÄ°Åž</h3>
            <input type="password" id="login-pass" placeholder="ERÄ°ÅžÄ°M ANAHTARI" style="text-align:center; letter-spacing:5px;">
            <div id="2fa-box" style="display:none; margin-top:10px;">
                <p style="color:var(--success);">KOD: <span id="2fa-code" style="font-weight:bold; color:white;"></span></p>
                <input type="text" id="login-2fa" placeholder="KODU GÄ°RÄ°N" style="text-align:center;">
            </div>
            <button class="cyber-btn" id="btn-l1" onclick="app.loginStep1()">DEVAM</button>
            <button class="cyber-btn" id="btn-l2" onclick="app.loginStep2()" style="display:none;">GÄ°RÄ°Åž</button>
            <p id="login-msg" style="margin-top:15px; color:var(--accent); font-weight:bold;"></p>
            <button class="nav-btn" onclick="document.getElementById('login-modal').style.display='none'" style="justify-content:center;">Ä°PTAL</button>
        </div>
    </div>

    <div id="edit-modal">
        <div class="glass-box" style="width:400px; border-color:var(--admin-gold);">
            <h3 style="color:var(--admin-gold);">PERSONEL DÃœZENLE</h3>
            <input type="hidden" id="edit-id">
            
            <label>Ad Soyad</label>
            <input id="edit-name">
            
            <label>Kod AdÄ±</label>
            <input id="edit-code">
            
            <label>Yetki Seviyesi</label>
            <select id="edit-role">
                <option value="staff">Personel</option>
                <option value="admin">YÃ¶netici</option>
            </select>

            <label style="color:var(--accent);">Yeni Åžifre (Opsiyonel)</label>
            <input id="edit-pass" placeholder="DeÄŸiÅŸtirmek iÃ§in yeni ÅŸifreyi yazÄ±n..." style="border:1px dashed var(--accent);">
            
            <button class="cyber-btn btn-gold" style="width:100%" onclick="app.saveEdit()">KAYDET & GÃœNCELLE</button>
            <button class="nav-btn" onclick="document.getElementById('edit-modal').style.display='none'" style="text-align:center; width:100%">Ä°PTAL</button>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        const CONFIG = {
            WEB_REP: "https://discord.com/api/webhooks/1462228533509361839/fZmCO4aEvvwKT_01NGI-KY5rs7t5rQyYIxaaLylENigt13K0EVPbuH7nKfQgSkWQ2nP7",
            WEB_OPS: "https://discord.com/api/webhooks/1462228977346412736/XyP1g3QXXOoXcg9vFnr5DMJ0PMygNHEx-TjhyMzBokQ1b8D9hZ-HGUubZKZUJSJHdi-X",
            TAG_REP: "<@997276536250056855>",
            TAG_OPS: "<@997275075839528970>"
        };

        const SFX = {
            ctx: new (window.AudioContext || window.webkitAudioContext)(),
            playTone: function(freq, type, dur) {
                if(this.ctx.state==='suspended')this.ctx.resume();
                const o=this.ctx.createOscillator(), g=this.ctx.createGain();
                o.type=type; o.frequency.value=freq; o.connect(g); g.connect(this.ctx.destination);
                o.start(); g.gain.exponentialRampToValueAtTime(0.00001, this.ctx.currentTime+dur);
                o.stop(this.ctx.currentTime+dur);
            },
            click: function() { this.playTone(1200, 'sine', 0.1); },
            hover: function() { this.playTone(400, 'triangle', 0.05); },
            error: function() { this.playTone(150, 'sawtooth', 0.3); setTimeout(()=>this.playTone(100,'sawtooth',0.3),150); },
            success: function() { this.playTone(800, 'sine', 0.1); setTimeout(()=>this.playTone(1200,'sine',0.2),100); },
            boot: function() { try { let t=0; for(let i=0;i<5;i++){ setTimeout(()=>this.playTone(200+(i*100), 'square', 0.1), t); t+=100; } } catch(e){} }
        };

        const app = {
            state: { user: null, fail: 0, visiblePass: new Set(), tUser: null, genCode: null,
                db: {
                    defcon: localStorage.getItem('mit_v22_1_defcon') || 1,
                    personnel: JSON.parse(localStorage.getItem('mit_v22_1_staff')) || [
                        { id: 'ADM-001', name: 'HAKAN F.', codename: 'KARTAL', role: 'admin', rank: 'BAKAN', pass: 'GÃ¶kSancak1881', gender:'men', photoId:33, cover: {fakeName: 'Ahmet YÄ±lmaz', fakeJob: 'Akademisyen', fakePhotoId: 10} },
                        { id: 'OPS-007', name: 'ZÃœMRÃœT K.', codename: 'ANKA', role: 'staff', rank: 'SAHA UZMANI', pass: '1234', gender:'women', photoId:45, cover: {fakeName: 'AyÅŸe Demir', fakeJob: 'EczacÄ±', fakePhotoId: 22} }
                    ],
                    reports: JSON.parse(localStorage.getItem('mit_v22_1_reports')) || [],
                    apps: JSON.parse(localStorage.getItem('mit_v22_1_apps')) || [],
                    tips: JSON.parse(localStorage.getItem('mit_v22_1_tips')) || [],
                    ops: JSON.parse(localStorage.getItem('mit_v22_1_ops')) || [],
                    chat: JSON.parse(localStorage.getItem('mit_v22_1_chat')) || [{user:'SÄ°STEM', msg:'AÄŸ aktif.', time:'00:00'}],
                    audit: JSON.parse(localStorage.getItem('mit_v22_1_audit')) || [],
                    announcements: JSON.parse(localStorage.getItem('mit_v22_1_ann')) || [{title: "SÄ°STEM GÃœNCEL", msg: "v22.1 KIZIL ELMA", type: "critical", date: new Date().toLocaleDateString()}],
                    wanted: [{name:'GÃ–LGE', crime:'Casusluk', status:'ARANIYOR'}]
                }
            },

            init: function() {
                this.bootSequence();
                this.applyDefcon(this.state.db.defcon);
                document.querySelectorAll('button, .nav-btn').forEach(b => {
                    b.addEventListener('mouseenter', ()=>SFX.hover());
                    b.addEventListener('click', ()=>SFX.click());
                });
            },

            bootSequence: function() {
                const s = document.getElementById('boot-screen');
                if(!s) { this.initAppLogic(); return; }
                const t = document.getElementById('boot-text');
                const lines = ["BIOS DATE 01/18/26 15:00:00", "establishing uplink...... SUCCESS", "INITIATING KIZIL_ELMA PROTOCOL..."];
                let i = 0;
                try { SFX.boot(); } catch(e){}
                const int = setInterval(() => {
                    if(i < lines.length) { t.innerHTML += lines[i] + "<br>"; i++; } 
                    else { clearInterval(int); s.style.opacity = '0'; document.getElementById('main-app').style.opacity = '1'; setTimeout(() => { s.style.display='none'; this.initAppLogic(); }, 1000); }
                }, 150);
            },

            initAppLogic: function() {
                this.updateClock(); setInterval(() => this.updateClock(), 1000);
                this.initParticles();
                this.renderPublic(); this.nav('public');
            },

            setDefcon: function(lvl) { this.state.db.defcon = lvl; localStorage.setItem('mit_v22_1_defcon', lvl); this.applyDefcon(lvl); },
            applyDefcon: function(lvl) { document.body.className = `defcon-${lvl}`; const el = document.getElementById('defcon-disp'); if(el) el.innerText = lvl; },
            initParticles: function() {
                const cvs=document.getElementById('particles-js'), ctx=cvs.getContext('2d');
                cvs.width=window.innerWidth; cvs.height=window.innerHeight;
                let pts=[]; for(let i=0;i<50;i++) pts.push({x:Math.random()*cvs.width, y:Math.random()*cvs.height, vx:(Math.random()-.5), vy:(Math.random()-.5)});
                function anim(){ ctx.clearRect(0,0,cvs.width,cvs.height); ctx.fillStyle='rgba(255,255,255,0.1)'; pts.forEach(p=>{ p.x+=p.vx; p.y+=p.vy; if(p.x<0||p.x>cvs.width)p.vx*=-1; if(p.y<0||p.y>cvs.height)p.vy*=-1; ctx.beginPath(); ctx.arc(p.x,p.y,1.5,0,6.28); ctx.fill(); }); requestAnimationFrame(anim); } anim();
            },

            sendDiscord: async function(url, tag, title, desc, color, fields) {
                const p = { username: "MÄ°T Ä°STÄ°HBARAT", avatar_url: "https://upload.wikimedia.org/wikipedia/tr/6/61/Mitlogo.png", content: tag, embeds: [{title, description: desc, color, fields, footer: { text: "KIZIL ELMA v22.1" }, timestamp: new Date()}] };
                try { await fetch(url, { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify(p) }); } catch(e){}
            },

            nav: function(id) {
                document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
                document.getElementById('panel-' + id).classList.add('active');
                if(id === 'map') setTimeout(() => this.initMap(), 200);
                if(id === 'chat') this.renderChat();
                if(id === 'hr') this.renderHR();
                if(id === 'ops') this.renderOps();
                if(id === 'db') this.renderLogs();
                if(id === 'reports') this.renderReports();
                if(id === 'dashboard') this.updateDash();
            },

            showLogin: function() { document.getElementById('login-modal').style.display='flex'; document.getElementById('2fa-box').style.display='none'; document.getElementById('btn-l1').style.display='inline-block'; document.getElementById('btn-l2').style.display='none'; document.getElementById('login-pass').value=''; document.getElementById('login-2fa').value=''; document.getElementById('login-msg').innerText=''; this.state.fail = 0; },
            loginStep1: function() {
                const p = document.getElementById('login-pass').value.trim();
                const u = this.state.db.personnel.find(x => x.pass === p);
                if(u){ this.state.tUser=u; this.state.genCode=Math.floor(1000+Math.random()*9000); document.getElementById('2fa-code').innerText=this.state.genCode; document.getElementById('2fa-box').style.display='block'; document.getElementById('btn-l1').style.display='none'; document.getElementById('btn-l2').style.display='inline-block'; SFX.success(); } 
                else { SFX.error(); this.failLogin(); }
            },
            loginStep2: function() {
                if(parseInt(document.getElementById('login-2fa').value)===this.state.genCode) {
                    SFX.success(); this.state.user=this.state.tUser; this.state.fail=0;
                    document.getElementById('login-modal').style.display='none'; document.getElementById('menu-guest').style.display='none'; document.getElementById('menu-staff').style.display='block';
                    document.getElementById('u-name').innerText=this.state.user.name; document.getElementById('u-code').innerText="KOD: "+this.state.user.codename; document.getElementById('u-code').style.display='block';
                    document.getElementById('u-role').innerText=this.state.user.role==='admin'?'YÃ–NETÄ°CÄ°':this.state.user.rank; document.getElementById('u-role').style.color=this.state.user.role==='admin'?'var(--admin-gold)':'#666';
                    document.getElementById('u-photo').src=`https://randomuser.me/api/portraits/${this.state.user.gender}/${this.state.user.photoId}.jpg`; document.getElementById('u-photo').style.display='block'; document.getElementById('u-icon').style.display='none';
                    this.logAudit('GÄ°RÄ°Åž', `${this.state.user.codename} sisteme girdi.`); this.nav('dashboard');
                } else { SFX.error(); this.failLogin(); }
            },
            failLogin: function(){ this.state.fail++; document.getElementById('login-msg').innerText=`HATA (${this.state.fail}/3)`; if(this.state.fail>=3){ SFX.error(); document.getElementById('lockdown-screen').style.display='flex'; } },
            logout: function() { location.reload(); },

            renderReports: function() { const f = document.getElementById('reports-feed'); f.innerHTML=''; this.state.db.reports.forEach(r => { f.innerHTML+=`<div class="report-card ${r.type==='op'?'report-op':''}"><div class="discord-tag">SENT > WEBHOOK</div><div style="display:flex; justify-content:space-between;"><span style="color:white; font-weight:bold;">${r.subject}</span><span style="color:#666; font-size:0.7rem;">${r.author} | ${r.date}</span></div><p style="color:#aaa; margin-top:5px; font-size:0.9rem;">${r.content}</p></div>`; }); },
            submitReport: function() {
                const t=document.getElementById('report-type').value, s=document.getElementById('report-subj').value, c=document.getElementById('report-content').value;
                if(!s||!c){ SFX.error(); return alert("Eksik!"); }
                this.state.db.reports.unshift({author:this.state.user.codename, type:t, subject:s, content:c, date:new Date().toLocaleString()}); this.save(); this.renderReports();
                this.sendDiscord(CONFIG.WEB_REP, CONFIG.TAG_REP, "ðŸ“ SAHA RAPORU", `**${s}**`, 3447003, [{name:"Ajan",value:this.state.user.codename, inline:true}, {name:"Tip",value:t.toUpperCase(), inline:true}, {name:"Ä°Ã§erik",value:c}]);
                document.getElementById('report-subj').value=''; document.getElementById('report-content').value=''; SFX.success();
            },

            renderOps: function() { const t=document.querySelector('#ops-table tbody'); t.innerHTML=''; const sel=document.getElementById('op-lead'); sel.innerHTML=''; this.state.db.personnel.forEach(p=>sel.innerHTML+=`<option value="${p.codename}">${p.codename}</option>`); this.state.db.ops.forEach((o,i)=>{ t.innerHTML+=`<tr><td style="color:white">${o.name}</td><td>${o.lead}</td><td style="color:${o.status==='AKTÄ°F'?'var(--accent)':'#666'}">${o.status}</td><td>${o.status==='AKTÄ°F'?`<button class="cyber-btn btn-small" onclick="app.endOp(${i})">BÄ°TÄ°R</button>`:'-'}</td></tr>`; }); },
            addOp: function() { const n=document.getElementById('op-name').value, l=document.getElementById('op-lead').value; if(!n)return; this.state.db.ops.unshift({name:n, lead:l, status:'AKTÄ°F'}); this.save(); document.getElementById('new-op-modal').style.display='none'; this.renderOps(); this.sendDiscord(CONFIG.WEB_OPS, CONFIG.TAG_OPS, "ðŸš¨ YENÄ° GÃ–REV EMRÄ°", `**Operasyon:** ${n}`, 15158332, [{name:"Tim Lideri",value:l,inline:true}, {name:"Durum",value:"BAÅžLATILDI",inline:true}]); SFX.success(); },
            endOp: function(i) { this.state.db.ops[i].status='PASÄ°F'; this.save(); this.renderOps(); },

            renderHR: function() {
                const isAdmin = this.state.user.role==='admin';
                document.getElementById('admin-tools').style.display=isAdmin?'block':'none';
                document.getElementById('admin-apps-section').style.display=isAdmin?'block':'none';
                document.getElementById('hr-table-head').innerHTML=isAdmin?`<tr><th>Ä°SÄ°M</th><th>KOD</th><th>ROL</th><th>SAHTE</th><th>ÅžÄ°FRE</th><th>Ä°ÅžLEM</th></tr>`:`<tr><th>KOD ADI</th><th>RÃœTBE</th><th>DURUM</th></tr>`;
                const body=document.getElementById('hr-table-body'); body.innerHTML='';
                this.state.db.personnel.forEach(p=>{
                    if(isAdmin){
                        const vis=this.state.visiblePass.has(p.id);
                        body.innerHTML+=`<tr><td>${p.name}</td><td style="color:var(--accent);font-weight:bold;">${p.codename}</td><td style="color:${p.role==='admin'?'var(--admin-gold)':'#fff'}">${p.role.toUpperCase()}</td><td><div style="font-size:0.7rem;color:var(--staff-blue)">${p.cover.fakeName}</div></td><td><span class="blur-text ${vis?'visible':''}" onclick="app.togglePass('${p.id}')">${p.pass}</span></td><td><button class="cyber-btn btn-small btn-gold" onclick="app.editUser('${p.id}')"><i class="fas fa-edit"></i></button><button class="cyber-btn btn-small" onclick="app.drawID('${p.id}','REAL')">R</button><button class="cyber-btn btn-small btn-fake" onclick="app.drawID('${p.id}','FAKE')">S</button><button class="cyber-btn btn-small" style="border-color:#555;" onclick="app.fireStaff('${p.id}')">X</button></td></tr>`;
                    } else body.innerHTML+=`<tr><td style="color:var(--staff-blue)">${p.codename}</td><td>${p.rank}</td><td style="color:var(--success)">AKTÄ°F</td></tr>`;
                });
                if(isAdmin){
                    const l=document.getElementById('hr-apps-list'); l.innerHTML=this.state.db.apps.length?'':'<span style="color:#666">Bekleyen yok.</span>';
                    this.state.db.apps.forEach((a,i)=>{
                        let rank=a.skill==='siber'?"SÄ°BER UZMANI":(a.skill==='saha'?"SAHA AJANI":"ANALÄ°ST");
                        l.innerHTML+=`<div style="background:#0a0a0a; border:1px solid #222; padding:15px;"><strong style="color:white">${a.name}</strong> (${a.skill})<br><small>${a.tc}</small><br><input id="ac-${i}" placeholder="KOD ADI" style="width:100%; margin-top:5px;"><div style="display:flex; gap:5px;"><button class="cyber-btn btn-small" onclick="app.approveApp(${i},'${rank}')">ONAY</button><button class="cyber-btn btn-small" style="border-color:#555;" onclick="app.rejectApp(${i})">RED</button></div></div>`;
                    });
                    const tl=document.getElementById('hr-tips-list'); tl.innerHTML=this.state.db.tips.length?'':'<span style="color:#666">Ä°hbar yok.</span>';
                    this.state.db.tips.forEach((tp, i)=>{ tl.innerHTML += `<div style="border-bottom:1px solid #333; padding:10px;"><strong style="color:var(--accent)">${tp.subject}</strong> <small style="float:right">${tp.date}</small><p style="font-size:0.9rem; color:#ccc; margin-top:5px;">${tp.text}</p><button class="cyber-btn btn-small" style="margin-top:5px; border-color:#555" onclick="app.delTip(${i})">SÄ°L</button></div>` });
                    document.getElementById('id-actions').innerHTML=`<button class="cyber-btn btn-small" onclick="app.downloadID()">Ä°NDÄ°R</button>`;
                } else document.getElementById('id-actions').innerHTML='<span style="color:#666">Yetkisiz</span>';
            },

            editUser: function(id) { 
                const p=this.state.db.personnel.find(x=>x.id===id); 
                document.getElementById('edit-id').value=p.id; 
                document.getElementById('edit-name').value=p.name; 
                document.getElementById('edit-code').value=p.codename; 
                document.getElementById('edit-role').value=p.role; 
                document.getElementById('edit-pass').value = ''; 
                document.getElementById('edit-modal').style.display='flex'; 
            },
            saveEdit: function() { 
                const id=document.getElementById('edit-id').value, p=this.state.db.personnel.find(x=>x.id===id); 
                if(p){ 
                    p.name=document.getElementById('edit-name').value; 
                    p.codename=document.getElementById('edit-code').value; 
                    p.role=document.getElementById('edit-role').value; 
                    const newPass = document.getElementById('edit-pass').value.trim();
                    if(newPass.length > 0) p.pass = newPass;
                    this.save(); this.renderHR(); document.getElementById('edit-modal').style.display='none'; 
                } 
            },
            
            approveApp: function(idx,rank){ const c=document.getElementById(`ac-${idx}`).value.toUpperCase(); if(!c)return alert("Kod!"); const a=this.state.db.apps[idx]; const nP={id:"AG-"+Math.floor(100+Math.random()*900),name:a.name,codename:c,role:'staff',rank,pass:"MIT"+Math.floor(1000+Math.random()*9000),gender:a.gender,photoId:Math.floor(Math.random()*99),cover:{fakeName:"Sivil "+Math.floor(Math.random()*100),fakeJob:"MÃ¼hendis",fakePhotoId:Math.floor(Math.random()*99)}}; this.state.db.personnel.push(nP); this.state.db.apps.splice(idx,1); this.save(); this.renderHR(); SFX.success(); },
            rejectApp: function(idx){ this.state.db.apps.splice(idx,1); this.save(); this.renderHR(); },
            delTip: function(idx){ this.state.db.tips.splice(idx,1); this.save(); this.renderHR(); },
            fireStaff: function(id){ if(confirm("Sil?")){ const i=this.state.db.personnel.findIndex(x=>x.id===id); if(i>-1)this.state.db.personnel.splice(i,1); this.save(); this.renderHR(); }},
            togglePass: function(id){ this.state.visiblePass.has(id)?this.state.visiblePass.delete(id):this.state.visiblePass.add(id); this.renderHR(); },

            drawID: function(id,mode) {
                const p=this.state.db.personnel.find(x=>x.id===id); if(!p)return;
                const cvs=document.getElementById('idCardCanvas'), ctx=cvs.getContext('2d');
                const w=cvs.width, h=cvs.height, isReal=mode==='REAL';
                const bgC=isReal?["#0a0000","#1c0000"]:["#ffffff","#e0e0e0"];
                const grd=ctx.createLinearGradient(0,0,w,h); grd.addColorStop(0,bgC[0]); grd.addColorStop(1,bgC[1]);
                ctx.fillStyle=grd; ctx.fillRect(0,0,w,h);
                if(isReal){ ctx.save(); ctx.globalAlpha=0.1; ctx.fillStyle="red"; ctx.beginPath(); ctx.arc(w/2,h/2,90,0,6.28); ctx.fill(); ctx.restore(); }
                ctx.fillStyle=isReal?"#ff0000":"#005588"; ctx.fillRect(0,0,w,60);
                ctx.fillStyle="#fff"; ctx.textAlign="center"; ctx.font="bold 20px Arial"; ctx.fillText(isReal?"T.C. MÄ°LLÄ° Ä°STÄ°HBARAT TEÅžKÄ°LATI":"TÃœRKÄ°YE CUMHURÄ°YETÄ°",w/2,30);
                ctx.font="12px monospace"; ctx.fillText(isReal?"RESMÄ° KÄ°MLÄ°K":"KÄ°MLÄ°K KARTI",w/2,50);
                const img=new Image(); img.crossOrigin="Anonymous"; img.src=`https://randomuser.me/api/portraits/${p.gender}/${isReal?p.photoId:p.cover.fakePhotoId}.jpg`;
                const px=30,py=80,pw=120,ph=150; ctx.strokeStyle=isReal?"#ff0000":"#005588"; ctx.lineWidth=3; ctx.strokeRect(px,py,pw,ph); ctx.fillStyle="#222"; ctx.fillRect(px,py,pw,ph);
                const tx=170; ctx.textAlign="left";
                const df=(l,v,y)=>{ ctx.fillStyle=isReal?"#888":"#555"; ctx.font="10px Arial"; ctx.fillText(l,tx,y); ctx.fillStyle=isReal?"#fff":"#000"; ctx.font="bold 16px Arial"; ctx.fillText(v.toUpperCase(),tx,y+18); };
                df("ADI SOYADI",isReal?p.name:p.cover.fakeName,90); df("GÃ–REVÄ°",isReal?p.rank:p.cover.fakeJob,130);
                if(isReal){ df("KOD ADI",p.codename,170); ctx.fillStyle="red"; ctx.font="bold 12px monospace"; ctx.fillText("GÄ°ZLÄ°",tx,220); } else { df("DOÄžUM", "15.04.1990",170); }
                img.onload=()=>{ ctx.drawImage(img,px,py,pw,ph); };
            },
            downloadID: function(){ const l=document.createElement('a'); l.download='ID.png'; l.href=document.getElementById('idCardCanvas').toDataURL(); l.click(); },

            renderPublic: function(){ document.getElementById('feed-public').innerHTML=''; this.state.db.announcements.forEach(a=>{ document.getElementById('feed-public').innerHTML+=`<div style="padding:15px; background:#0f0f0f; border-left:4px solid ${a.type==='critical'?'var(--accent)':'var(--staff-blue)'}; margin-bottom:10px;"><strong style="color:white">${a.title}</strong> <span style="float:right;font-size:0.7rem;color:#666">${a.date}</span><p style="color:#aaa;margin-top:5px;">${a.msg}</p></div>`; }); const t=document.querySelector('#wanted-table tbody'); t.innerHTML=''; this.state.db.wanted.forEach(w=>t.innerHTML+=`<tr><td>${w.name}</td><td>${w.crime}</td><td style="color:var(--accent)">${w.status}</td></tr>`); },
            adminPostAnnounce: function(){ if(this.state.user.role!=='admin')return; const t=document.getElementById('ann-title').value, m=document.getElementById('ann-msg').value, tp=document.getElementById('ann-type').value; if(!t)return; this.state.db.announcements.unshift({title:t, msg:m, type:tp, date:new Date().toLocaleDateString()}); this.save(); alert("YayÄ±nlandÄ±"); this.renderPublic(); },
            submitApp: function(){ const tc=document.getElementById('app-tc').value, name=document.getElementById('app-name').value, g=document.getElementById('app-gender').value, s=document.getElementById('app-skill').value; if(!tc||!name){SFX.error(); return alert("Eksik!");} this.state.db.apps.push({tc, name, skill:s, gender:g, date:new Date().toLocaleDateString()}); this.save(); alert("GÃ¶nderildi."); this.nav('public'); },
            
            sendTip: function(){ 
                const s=document.getElementById('tip-subj').value, t=document.getElementById('tip-text').value; 
                if(!t){ SFX.error(); return; }
                this.state.db.tips.unshift({subject:s||"Ä°simsiz", text:t, date:new Date().toLocaleString()});
                this.save();
                alert("Ä°hbar ÅŸifrelendi ve havuza iletildi."); 
                document.getElementById('tip-subj').value=''; document.getElementById('tip-text').value=''; SFX.success();
            },
            
            updateDash: function(){ document.getElementById('stat-staff').innerText=this.state.db.personnel.length; document.getElementById('stat-ops').innerText=this.state.db.ops.filter(o=>o.status==='AKTÄ°F').length; const l=document.getElementById('dash-logs'); l.innerHTML=''; this.state.db.audit.slice(-8).reverse().forEach(x=>l.innerHTML+=`<div style="border-bottom:1px solid #222; padding:5px;"><span style="color:var(--accent)">[${x.time}]</span> ${x.detail}</div>`); },
            renderChat: function(){ const w=document.getElementById('chat-window'); w.innerHTML=''; this.state.db.chat.forEach(c=>{ const me=this.state.user&&c.user===this.state.user.codename; w.innerHTML+=`<div class="msg ${me?'msg-me':'msg-other'}"><span class="msg-sender">${me?'BEN':c.user}</span>${c.msg}</div>`; }); w.scrollTop=w.scrollHeight; },
            sendChat: function(){ const t=document.getElementById('chat-input').value; if(!t)return; this.state.db.chat.push({user:this.state.user.codename, msg:t, time:new Date().toLocaleTimeString()}); this.save(); document.getElementById('chat-input').value=''; this.renderChat(); SFX.click(); },
            
            queryDB: function(){ 
                const q=document.getElementById('db-q').value; if(!q){SFX.error(); return;}
                this.logAudit('SORGU', `Aranan: ${q}`);
                SFX.success();
                
                // MOCK BIOMETRIC DATA GENERATOR
                const blood = ["A Rh+", "0 Rh+", "B Rh-", "AB Rh+"][Math.floor(Math.random()*4)];
                const gender = Math.random()>0.5 ? 'men' : 'women';
                const photo = Math.floor(Math.random()*80);
                const score = Math.floor(Math.random()*100);
                const status = score > 80 ? "<span style='color:red'>KRÄ°MÄ°NAL</span>" : "<span style='color:lime'>TEMÄ°Z</span>";
                const hash = Array(16).fill(0).map(()=>Math.random().toString(36)[2]).join('').toUpperCase();

                const html = `
                    <div class="bio-grid">
                        <img src="https://randomuser.me/api/portraits/${gender}/${photo}.jpg" class="bio-img">
                        <div class="bio-data">
                            <div><span class="bio-label">KÄ°MLÄ°K</span> <span>${q.toUpperCase()}</span></div>
                            <div><span class="bio-label">KAN GRUBU</span> <span>${blood}</span></div>
                            <div><span class="bio-label">GSM SÄ°NYAL</span> <span>AKTÄ°F (Baz: Ä°st-Avr-342)</span></div>
                            <div><span class="bio-label">PARMAK Ä°ZÄ°</span> <span>${hash}</span></div>
                            <div><span class="bio-label">GBT SKORU</span> <span>${score}/100</span></div>
                            <div><span class="bio-label">DURUM</span> <strong>${status}</strong></div>
                        </div>
                    </div>
                `;
                document.getElementById('db-res').innerHTML = html;
            },
            
            renderLogs: function(){ const t=document.querySelector('#audit-table tbody'); t.innerHTML=''; this.state.db.audit.slice().reverse().forEach(l=>t.innerHTML+=`<tr><td>${l.time}</td><td>${l.user}</td><td>${l.detail}</td></tr>`); },
            save: function(){ 
                localStorage.setItem('mit_v22_1_staff', JSON.stringify(this.state.db.personnel)); 
                localStorage.setItem('mit_v22_1_apps', JSON.stringify(this.state.db.apps)); 
                localStorage.setItem('mit_v22_1_tips', JSON.stringify(this.state.db.tips)); 
                localStorage.setItem('mit_v22_1_ops', JSON.stringify(this.state.db.ops)); 
                localStorage.setItem('mit_v22_1_chat', JSON.stringify(this.state.db.chat)); 
                localStorage.setItem('mit_v22_1_audit', JSON.stringify(this.state.db.audit)); 
                localStorage.setItem('mit_v22_1_ann', JSON.stringify(this.state.db.announcements)); 
                localStorage.setItem('mit_v22_1_reports', JSON.stringify(this.state.db.reports)); 
            },
            logAudit: function(act, det){ this.state.db.audit.push({time:new Date().toLocaleString(), user:this.state.user?this.state.user.name:'SÄ°STEM', detail:`${act}: ${det}`}); this.save(); },
            initMap: function(){ if(this.mapInit)return; const m=L.map('map',{zoomControl:false}).setView([39.92,32.85],6); L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png').addTo(m); this.mapInit=true; m.invalidateSize(); },
            updateClock: function(){ document.getElementById('sys-clock').innerText=new Date().toLocaleTimeString(); }
        };
        window.onload = () => app.init();
    </script>
</body>
</html>


